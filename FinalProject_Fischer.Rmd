---
title: "Final Project - Results and Analysis"
author: "Georgianna Fischer"
date: "2023-11-21"
output:
  pdf_document: default
  word_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```

## Data Cleaning

```{r data cleaning}
if (interactive()) {
  chloride_raw <- read.csv(file.choose())
} else {
  chloride_raw <- read.csv("Chloride_ogR.csv")
}

chloride_data <- chloride_raw %>% 
  subset(select = -c(DOW.site.no.., source.., location, MPCA.Chloride.Impairment.Year, no..samples, project.id, dataset.location..., tbd, tbd.1, notes, X, X....where.the.datafile.is.located..brackets.indicate.the.shared.drive.name.)) %>%
  rename( "n_overall" = "n..overall.Cl.avg.",
              "Overall_avg_Cl" = "Overall.Cl.Avg...mg.L.",
               "n_summer_overall" = "n..overall.summer.Cl.avg.",
                "summer_overall_avg_cl" = "Overall.Summer.Cl.Avg...mg.L.",
               "n_recent_overall" = "n..recent.cl.avg.",
               "recent_avg_cl" = "Recent.Cl.Avg...mg.L.",
               "n_recent_summer_overall" = "n..recent.summer.cl.avg.",
               "summer_recent_avg_cl" = "Recent.Summer.Cl.Avg...mg.L.",
               "no_yrs" = "no..yrs.data")
chloride_data %>% drop_na(summer_overall_avg_cl)

if (interactive()) {
  SURF_raw <- read.csv(file.choose())
} else {
  SURF_raw <- read.csv("SURFdata.csv")
}
SURF_data <- subset(SURF_raw, select = -c(X, X.1, X.2, X.3, X.4))
```

## Historical Graph

```{r Historic Patterns}
chloride_sum <- chloride_data %>%
  drop_na(summer_overall_avg_cl) %>%
  group_by(type) %>%
  summarize(mean_Overall_avg_Cl = mean(Overall_avg_Cl), mean_summer_overall_cl = mean(summer_overall_avg_cl), mean_recent_cl = mean(recent_avg_cl), mean_recent_summer_cl = mean(summer_recent_avg_cl))

Avg_summer_plot <- chloride_sum %>%
  ggplot(aes(x = type, y = mean_summer_overall_cl)) + 
  geom_bar(stat = 'identity', fill = 'lightblue') +
  labs(title = "Historical (1969-2022) Average Summer Chloride by Type", 
       x = "Waterbody Type", 
       y = "Mean summer chloride (mg/L)") + 
  theme_minimal()
print(Avg_summer_plot)
```

## Historical Draft Analysis
  The results of the historical summer chloride graph shows a lot of variance between the types of water bodies. The lowest average chloride values lie in ponds and mixed wetlands and ponds, with 28 mg/L of chloride present. Lakes, ponds, wetlands, and streams all had relatively low historical summer chloride, while drains and springs had the highest chloride concentrations at roughly 232 and 229 mg/L, respectively.  

## Recent graphs
### Histogram
```{r chloride dist}
Cl_dist_23 <- SURF_data %>%
  ggplot( aes(x=Cl)) +
    geom_histogram( binwidth=20, fill="#69b3a2", color="#e9ecef", alpha=0.9) +
    ggtitle("Chloride Concentration") +
    theme_minimal() +
    theme(
      plot.title = element_text(size=15))
print(Cl_dist_23)
```


### Scatterplots
```{r recent patterns scatterplots}
O18_plot <- ggplot(data = SURF_data, aes(x = Cl, y = X18O)) + 
  geom_point() + 
  geom_smooth(method = "lm", color = "blue") +
  labs(x = "Chloride (mg/l)", y = "18O")+
  theme_minimal() +
  theme(axis.title = element_text(size = 10))

Rd_length_plot <- ggplot(data = SURF_data, aes(x = Cl, y = RdLength_per_WtshdArea, color = X18O)) + 
  geom_point(color = "black", size = 1.5) +
  geom_point(size = 1, aes(color = X18O)) +
  geom_smooth(method = "lm", color = "burlywood") +
  scale_color_gradient2(low = "blue", mid = "white", high = "orange", midpoint = -7) +
  labs(x = "Chloride (mg/l)", y = "Road Length 
       per Watershed Area", color = "O18") +
  theme_minimal() +
  theme(legend.position = "none") +
  theme(axis.title = element_text(size = 10))


wtshd_dev_plot <- ggplot(data = SURF_data, aes(x = Cl, y = Percent_wtshd_dev, color = X18O)) + 
  geom_point(color = "black", size = 1.5) +
  geom_point(size = 1, aes(color = X18O)) +
  geom_smooth(method = "lm", color = "burlywood") +
  scale_color_gradient2(low = "blue", mid = "white", high = "orange", midpoint = -7) +
  labs(x = "Chloride (mg/l)", y = "Percent Developed", color = "O18") +
  coord_cartesian(ylim = c(0, 100)) + 
  theme_minimal() +
  theme(legend.position = "right") +
  theme(axis.title = element_text(size = 10), legend.title = element_text(size = 10), legend.text = element_text(size = 8))


DIC_plot <- ggplot(data = SURF_data, aes(x = Cl, y = DIC)) + 
  geom_point() + 
  geom_smooth(method = "lm", color = 'blue') +
  labs(x = "Chloride (mg/l)", y = "DIC")+
  theme_minimal() +
  theme(axis.title = element_text(size = 10))
library(patchwork)
combined_SURFplots <- O18_plot / DIC_plot / Rd_length_plot / wtshd_dev_plot + plot_layout(ncol = 2)
print(combined_SURFplots)
```


## Correlation Analysis

```{r correlation analysis and heat map}
numeric_SURF <- SURF_data %>%
  select(-c(Percent_wtshd_dev, RdLength_per_WtshdArea)) %>%
  select_if(is.numeric)

cor_matrix <- cor(numeric_SURF)

cor_df <- as.data.frame(as.table(cor_matrix))

ggplot(cor_df, aes(Var1, Var2, fill = Freq)) +
  geom_tile(color = "white") +
  scale_fill_gradient2(low = "blue", mid = "white", high = "red", midpoint = 0) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))


```


## Recent Linear Regressions

```{r recent patterns linear regressions}
O18_linearmod <- lm(X18O~Cl, data = SURF_data)
summary(O18_linearmod)
DIC_linearmod <- lm(DIC~Cl, data = SURF_data)
summary(DIC_linearmod)
wtshd_dev_linearmod <- lm(Percent_wtshd_dev~Cl, data = SURF_data)
summary(wtshd_dev_linearmod)
roads_linearmod <- lm(RdLength_per_WtshdArea~Cl, data = SURF_data)
summary(roads_linearmod)
```

## Analysis of recent trends
  The results of the relationship between the biogeochemical tracers and chloride showed much fine scale heterogeneity. Both oxygen isotope ratios (O18) and dissolved inorganic carbon (DIC) showed a lot of variance within the data, with a few outliers. While there is a general downward trend to the data, the relationship isn't very significant for either, although O18 is shown to have more of a relationship with the chloride values than DIC - the results of the linear regression show that the O18 relationship has a p-value of 0.0996 and an R-squared value of 0.08504, while the DIC relationship has a p-value of 0.66 and an R-squared value of 0.006328. 
  As for the land use indicators, both had a positive relationship with chloride concentrations. For every increase in mg/L of chloride, percentage of developed land within the watershed was shown to increase by 0.088824. Road length per watershed area increased by 0.003751 with chloride. Linear regression of these relationships indicates a relatively significant relationship for percent watershed developed and chloride, with a p-value of 0.00531 and an R-squared of 0.3751. The relationship between road length and chloride is slightly less significant, with a p-value of 0.127 and an R-squared of 0.1318. 